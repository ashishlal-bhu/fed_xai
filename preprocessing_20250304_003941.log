2025-03-04 01:03:14,361 - training - INFO - Starting XAI model training pipeline
2025-03-04 01:03:14,362 - training - INFO - Starting preprocessing for task: mortality
2025-03-04 01:03:14,363 - preprocessing - INFO - Memory usage: 415.64 MB
2025-03-04 01:03:14,364 - preprocessing - INFO - Starting preprocessing for task: mortality
2025-03-04 01:03:14,364 - preprocessing - INFO - Loading data with 20.0% sampling
2025-03-04 01:03:14,364 - preprocessing - INFO - Loading ADMISSIONS.csv
2025-03-04 01:03:15,558 - preprocessing - INFO - Loading PATIENTS.csv
2025-03-04 01:03:17,131 - preprocessing - INFO - Merging ADMISSIONS and PATIENTS
2025-03-04 01:03:32,461 - preprocessing - INFO - Original samples: 58976, Sampled: 11795
2025-03-04 01:03:32,462 - preprocessing - INFO - Original mortality rate: 0.099
2025-03-04 01:03:32,462 - preprocessing - INFO - Sampled mortality rate: 0.099
2025-03-04 01:03:32,462 - preprocessing - INFO - Loading LABEVENTS.csv in chunks
2025-03-04 01:03:40,021 - preprocessing - INFO - Processed 0 chunks, current total rows: 1522299
2025-03-04 01:03:40,022 - preprocessing - INFO - Memory usage: 747.77 MB
2025-03-04 01:03:50,888 - preprocessing - INFO - Finished loading LABEVENTS.csv. Final shape: (4430455, 4)
2025-03-04 01:03:52,066 - preprocessing - INFO - Loading CHARTEVENTS.csv in chunks
2025-03-04 01:04:00,271 - preprocessing - INFO - Processed 0 chunks, current total rows: 1873173
2025-03-04 01:04:00,271 - preprocessing - INFO - Memory usage: 826.65 MB
2025-03-04 01:05:22,644 - preprocessing - INFO - Processed 10 chunks, current total rows: 21785667
2025-03-04 01:05:22,644 - preprocessing - INFO - Memory usage: 1280.73 MB
2025-03-04 01:06:45,729 - preprocessing - INFO - Processed 20 chunks, current total rows: 41013735
2025-03-04 01:06:45,730 - preprocessing - INFO - Memory usage: 1699.30 MB
2025-03-04 01:08:09,717 - preprocessing - INFO - Processed 30 chunks, current total rows: 60598095
2025-03-04 01:08:09,718 - preprocessing - INFO - Memory usage: 2105.13 MB
2025-03-04 01:08:33,689 - preprocessing - INFO - Finished loading CHARTEVENTS.csv. Final shape: (64920828, 4)
2025-03-04 01:08:38,700 - preprocessing - INFO - Loading PROCEDURES_ICD.csv in chunks
2025-03-04 01:08:39,053 - preprocessing - INFO - Processed 0 chunks, current total rows: 47959
2025-03-04 01:08:39,054 - preprocessing - INFO - Memory usage: 2847.38 MB
2025-03-04 01:08:39,194 - preprocessing - INFO - Finished loading PROCEDURES_ICD.csv. Final shape: (47959, 5)
2025-03-04 01:08:45,087 - preprocessing - INFO - Loading DIAGNOSES_ICD.csv in chunks
2025-03-04 01:08:45,631 - preprocessing - INFO - Processed 0 chunks, current total rows: 130216
2025-03-04 01:08:45,631 - preprocessing - INFO - Memory usage: 2847.44 MB
2025-03-04 01:08:45,758 - preprocessing - INFO - Finished loading DIAGNOSES_ICD.csv. Final shape: (130216, 5)
2025-03-04 01:08:46,396 - preprocessing - INFO - Loading PRESCRIPTIONS.csv in chunks
2025-03-04 01:08:56,857 - preprocessing - INFO - Processed 0 chunks, current total rows: 828776
2025-03-04 01:08:56,857 - preprocessing - INFO - Memory usage: 3297.44 MB
2025-03-04 01:08:57,102 - preprocessing - INFO - Finished loading PRESCRIPTIONS.csv. Final shape: (828776, 19)
2025-03-04 01:08:58,408 - preprocessing - INFO - Data loading completed successfully
2025-03-04 01:08:58,417 - preprocessing - INFO - Extracting features
2025-03-04 01:08:58,418 - preprocessing - INFO - Converting ADMITTIME to datetime
2025-03-04 01:08:58,774 - preprocessing - INFO - Converting DISCHTIME to datetime
2025-03-04 01:08:58,797 - preprocessing - INFO - Converting DOB to datetime
2025-03-04 01:08:59,716 - preprocessing - INFO - Processing lab features
2025-03-04 01:09:01,299 - preprocessing - INFO - Processing vital signs
2025-03-04 01:09:02,338 - preprocessing - INFO - Processing procedures
2025-03-04 01:09:02,338 - preprocessing - INFO - Converting ICD9_CODE to string type
2025-03-04 01:09:04,301 - preprocessing - INFO - Processing diagnoses
2025-03-04 01:09:04,302 - preprocessing - INFO - Converting diagnoses ICD9_CODE to string type
2025-03-04 01:09:04,761 - preprocessing - INFO - Feature extraction completed. Shape: (11795, 38)
2025-03-04 01:09:05,235 - preprocessing - INFO - Memory usage: 1404.73 MB
2025-03-04 01:09:05,236 - training - INFO - Validating data splits...
2025-03-04 01:09:05,236 - training - INFO - Training set shape: (9436, 32)
2025-03-04 01:09:05,236 - training - INFO - Test set shape: (2359, 32)
2025-03-04 01:09:05,239 - training - INFO - 
Class distribution:
2025-03-04 01:09:05,241 - training - INFO - Training set:
MORTALITY
0.0    0.900699
1.0    0.099301
Name: proportion, dtype: float64
2025-03-04 01:09:05,242 - training - INFO - Test set:
MORTALITY
0.0    0.900805
1.0    0.099195
Name: proportion, dtype: float64
2025-03-04 01:09:05,246 - training - INFO - Finding best hyperparameters...
2025-03-04 01:09:05,246 - xai_model - INFO - Initializing XAI Model...
2025-03-04 01:09:05,247 - xai_model - INFO - Validating features...
2025-03-04 01:09:05,247 - xai_model - INFO - Validated 32 features
2025-03-04 01:09:17,610 - xai_model - INFO - Model initialized with:
2025-03-04 01:09:17,610 - xai_model - INFO - - Input dimensions: 32
2025-03-04 01:09:17,610 - xai_model - INFO - - Hidden units: 128
2025-03-04 01:09:17,610 - xai_model - INFO - - Dropout rate: 0.3
2025-03-04 01:09:17,610 - xai_model - INFO - - Learning rate: 0.001
2025-03-04 01:09:17,610 - xai_model - INFO - Starting model training...
2025-03-04 01:09:17,713 - xai_model - INFO - Class distribution: {0.0: 8499, 1.0: 937}
2025-03-04 01:09:17,714 - xai_model - INFO - Class weights: {0: 0.5551241, 1: 5.0352187}
2025-03-04 01:10:00,856 - xai_model - INFO - Model training completed
2025-03-04 01:10:00,856 - training - INFO - Parameters: {'units': 128, 'dropout': 0.3, 'learning_rate': 0.001}, Validation AUC: 0.835
2025-03-04 01:10:00,856 - xai_model - INFO - Initializing XAI Model...
2025-03-04 01:10:00,856 - xai_model - INFO - Validating features...
2025-03-04 01:10:00,856 - xai_model - INFO - Validated 32 features
2025-03-04 01:10:00,949 - xai_model - INFO - Model initialized with:
2025-03-04 01:10:00,949 - xai_model - INFO - - Input dimensions: 32
2025-03-04 01:10:00,949 - xai_model - INFO - - Hidden units: 64
2025-03-04 01:10:00,949 - xai_model - INFO - - Dropout rate: 0.2
2025-03-04 01:10:00,949 - xai_model - INFO - - Learning rate: 0.001
2025-03-04 01:10:00,949 - xai_model - INFO - Starting model training...
2025-03-04 01:10:00,951 - xai_model - INFO - Class distribution: {0.0: 8499, 1.0: 937}
2025-03-04 01:10:00,951 - xai_model - INFO - Class weights: {0: 0.5551241, 1: 5.0352187}
2025-03-04 01:10:17,975 - xai_model - INFO - Model training completed
2025-03-04 01:10:17,977 - training - INFO - Parameters: {'units': 64, 'dropout': 0.2, 'learning_rate': 0.001}, Validation AUC: 0.829
2025-03-04 01:10:17,977 - training - INFO - Best parameters found: {'units': 128, 'dropout': 0.3, 'learning_rate': 0.001}
2025-03-04 01:10:17,977 - training - INFO - Initializing model with best parameters
2025-03-04 01:10:17,979 - xai_model - INFO - Initializing XAI Model...
2025-03-04 01:10:17,979 - xai_model - INFO - Validating features...
2025-03-04 01:10:17,979 - xai_model - INFO - Validated 32 features
2025-03-04 01:10:18,165 - xai_model - INFO - Model initialized with:
2025-03-04 01:10:18,165 - xai_model - INFO - - Input dimensions: 32
2025-03-04 01:10:18,165 - xai_model - INFO - - Hidden units: 128
2025-03-04 01:10:18,165 - xai_model - INFO - - Dropout rate: 0.3
2025-03-04 01:10:18,165 - xai_model - INFO - - Learning rate: 0.001
2025-03-04 01:10:18,165 - training - INFO - Starting model training
2025-03-04 01:10:18,165 - xai_model - INFO - Starting model training...
2025-03-04 01:10:18,171 - xai_model - INFO - Class distribution: {0.0: 8499, 1.0: 937}
2025-03-04 01:10:18,171 - xai_model - INFO - Class weights: {0: 0.5551241, 1: 5.0352187}
2025-03-04 01:10:48,210 - xai_model - INFO - Model training completed
2025-03-04 01:10:48,211 - training - INFO - Evaluating model
2025-03-04 01:10:48,211 - xai_model - INFO - Evaluating model performance...
2025-03-04 01:10:49,789 - xai_model - INFO - 
Classification Report:
2025-03-04 01:10:50,051 - xai_model - INFO - 
              precision    recall  f1-score   support

         0.0       0.91      1.00      0.95      2125
         1.0       0.78      0.11      0.19       234

    accuracy                           0.91      2359
   macro avg       0.85      0.55      0.57      2359
weighted avg       0.90      0.91      0.88      2359

2025-03-04 01:10:50,051 - xai_model - INFO - 
Confusion Matrix:
2025-03-04 01:10:50,549 - xai_model - INFO - 
[[2118    7]
 [ 209   25]]
2025-03-04 01:10:50,765 - xai_model - INFO - 
ROC-AUC Score: 0.801
2025-03-04 01:10:50,765 - training - INFO - Initializing explainers
2025-03-04 01:10:50,765 - xai_model - INFO - Initializing explainers...
2025-03-04 01:10:51,234 - xai_model - INFO - Explainers initialized successfully
2025-03-04 01:10:51,234 - training - INFO - Plotting training history
2025-03-04 01:10:51,234 - visualization - INFO - Plotting training history...
2025-03-04 01:11:00,514 - training - INFO - Plotting confusion matrix
2025-03-04 01:11:00,514 - visualization - INFO - Plotting confusion matrix...
2025-03-04 01:11:00,985 - training - INFO - Generating explanations for 3 samples
2025-03-04 01:11:00,986 - training - INFO - 
Explaining instance 1709
2025-03-04 01:11:00,986 - training - INFO - True label: Not Deceased
2025-03-04 01:11:01,047 - training - INFO - Predicted probability of mortality: 0.082
2025-03-04 01:11:01,047 - training - INFO - Predicted class: Not Deceased
2025-03-04 01:11:01,047 - xai_model - INFO - Generating both explanation...
2025-03-04 01:11:08,588 - shap - INFO - num_full_subsets = 1
2025-03-04 01:11:08,589 - shap - INFO - remaining_weight_vector = array([0.17443519, 0.12030013, 0.09344742, 0.07752675, 0.06709046,
       0.05980635, 0.054511  , 0.05056092, 0.04757323, 0.04530784,
       0.0436088 , 0.04237292, 0.04153219, 0.04104357, 0.04088325])
2025-03-04 01:11:08,589 - shap - INFO - num_paired_subset_sizes = 15
2025-03-04 01:11:08,674 - shap - INFO - weight_left = 0.74368134682094
2025-03-04 01:11:18,190 - shap - INFO - np.sum(w_aug) = 32.0
2025-03-04 01:11:18,190 - shap - INFO - np.sum(self.kernelWeights) = 1.0
2025-03-04 01:11:22,917 - shap - INFO - phi = array([-2.89905165e-03, -7.36380224e-03, -3.77649583e-04, -3.03782409e-04,
        7.32794049e-03,  7.97774257e-03, -4.79268292e-03,  4.71712426e-04,
        5.06437400e-03, -1.90932915e-02,  6.64045462e-04,  8.11215703e-04,
        0.00000000e+00, -1.21947883e-04,  3.20644677e-03,  2.12827049e-03,
        7.55242101e-05,  1.62390629e-03, -3.57666668e-03, -1.93869431e-03,
        1.82280325e-03, -4.73568865e-04, -1.27355683e-03, -9.98892791e-04,
       -1.84696048e-04,  1.72070284e-04,  1.06762283e-03,  1.24229938e-04,
        5.93538740e-04, -2.48558611e-04, -6.87075461e-04, -8.21251767e-04])
2025-03-04 01:11:22,919 - shap - INFO - np.sum(w_aug) = 32.0
2025-03-04 01:11:22,919 - shap - INFO - np.sum(self.kernelWeights) = 1.0
2025-03-04 01:11:22,960 - shap - INFO - phi = array([ 2.89905198e-03,  7.36380196e-03,  3.77649898e-04,  3.03782018e-04,
       -7.32794024e-03, -7.97774302e-03,  4.79268278e-03, -4.71712714e-04,
       -5.06437434e-03,  1.90932917e-02, -6.64045822e-04, -8.11215743e-04,
        0.00000000e+00,  1.21948048e-04, -3.20644699e-03, -2.12827069e-03,
       -7.55240314e-05, -1.62390608e-03,  3.57666676e-03,  1.93869333e-03,
       -1.82280329e-03,  4.73568569e-04,  1.27355695e-03,  9.98892839e-04,
        1.84696107e-04, -1.72070518e-04, -1.06762374e-03, -1.24229902e-04,
       -5.93538702e-04,  2.48558683e-04,  6.87075530e-04,  8.21251836e-04])
2025-03-04 01:11:22,962 - xai_model - INFO - Raw SHAP values type: <class 'list'>
2025-03-04 01:11:22,962 - xai_model - INFO - Raw expected_value type: <class 'numpy.ndarray'>
2025-03-04 01:11:22,962 - xai_model - INFO - Processed values shape: (1, 32)
2025-03-04 01:11:22,962 - xai_model - INFO - Number of features: 32
2025-03-04 01:11:22,962 - xai_model - INFO - Final expected_value: 0.06961634159088134
2025-03-04 01:11:22,962 - visualization - INFO - Visualizing LIME explanation...
2025-03-04 01:11:23,401 - visualization - INFO - Visualizing SHAP values...
2025-03-04 01:11:23,401 - visualization - INFO - Values shape: (1, 32)
2025-03-04 01:11:23,401 - visualization - INFO - Number of features: 32
2025-03-04 01:11:23,401 - visualization - INFO - Processed instance values shape: (32,)
2025-03-04 01:11:23,402 - visualization - INFO - First few values: [0.00289905 0.0073638  0.00037765]
2025-03-04 01:11:23,866 - training - INFO - 
Explaining instance 2279
2025-03-04 01:11:23,866 - training - INFO - True label: Deceased
2025-03-04 01:11:23,943 - training - INFO - Predicted probability of mortality: 0.345
2025-03-04 01:11:23,944 - training - INFO - Predicted class: Not Deceased
2025-03-04 01:11:23,944 - xai_model - INFO - Generating both explanation...
2025-03-04 01:11:24,652 - shap - INFO - num_full_subsets = 1
2025-03-04 01:11:24,653 - shap - INFO - remaining_weight_vector = array([0.17443519, 0.12030013, 0.09344742, 0.07752675, 0.06709046,
       0.05980635, 0.054511  , 0.05056092, 0.04757323, 0.04530784,
       0.0436088 , 0.04237292, 0.04153219, 0.04104357, 0.04088325])
2025-03-04 01:11:24,653 - shap - INFO - num_paired_subset_sizes = 15
2025-03-04 01:11:24,734 - shap - INFO - weight_left = 0.74368134682094
2025-03-04 01:11:36,460 - shap - INFO - np.sum(w_aug) = 32.0
2025-03-04 01:11:36,460 - shap - INFO - np.sum(self.kernelWeights) = 0.9999999999999998
2025-03-04 01:11:36,495 - shap - INFO - phi = array([ 0.00667428, -0.01030733, -0.00169773,  0.00500757, -0.01266828,
       -0.01233505,  0.01040795, -0.00407129, -0.00092657, -0.10981328,
       -0.00477809,  0.        ,  0.        , -0.00039035,  0.00563555,
        0.00454575,  0.        , -0.03687428, -0.06322001, -0.03187672,
       -0.01123151, -0.00187288,  0.00620445, -0.00234407, -0.00032289,
        0.        ,  0.00160666, -0.00496743, -0.00163616, -0.00024082,
       -0.00210319, -0.00197232])
2025-03-04 01:11:36,496 - shap - INFO - np.sum(w_aug) = 32.0
2025-03-04 01:11:36,496 - shap - INFO - np.sum(self.kernelWeights) = 0.9999999999999998
2025-03-04 01:11:36,517 - shap - INFO - phi = array([-0.00667428,  0.01030733,  0.00169772, -0.00500757,  0.01266828,
        0.01233505, -0.01040795,  0.00407129,  0.00092657,  0.10981328,
        0.00477809,  0.        ,  0.        ,  0.00039035, -0.00563555,
       -0.00454575,  0.        ,  0.03687428,  0.06322001,  0.03187672,
        0.01123151,  0.00187288, -0.00620445,  0.00234407,  0.00032289,
        0.        , -0.00160665,  0.00496743,  0.00163616,  0.00024082,
        0.00210319,  0.00197232])
2025-03-04 01:11:36,518 - xai_model - INFO - Raw SHAP values type: <class 'list'>
2025-03-04 01:11:36,518 - xai_model - INFO - Raw expected_value type: <class 'numpy.ndarray'>
2025-03-04 01:11:36,519 - xai_model - INFO - Processed values shape: (1, 32)
2025-03-04 01:11:36,519 - xai_model - INFO - Number of features: 32
2025-03-04 01:11:36,519 - xai_model - INFO - Final expected_value: 0.06961634159088134
2025-03-04 01:11:36,519 - visualization - INFO - Visualizing LIME explanation...
2025-03-04 01:11:37,142 - visualization - INFO - Visualizing SHAP values...
2025-03-04 01:11:37,143 - visualization - INFO - Values shape: (1, 32)
2025-03-04 01:11:37,143 - visualization - INFO - Number of features: 32
2025-03-04 01:11:37,143 - visualization - INFO - Processed instance values shape: (32,)
2025-03-04 01:11:37,143 - visualization - INFO - First few values: [-0.00667428  0.01030733  0.00169772]
2025-03-04 01:11:37,691 - training - INFO - Pipeline completed successfully
